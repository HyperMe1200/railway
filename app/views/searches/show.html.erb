<h1>Поиск</h1>

<%= form_tag search_path do %>
  <div class="field">
    <%= label :first_station_id, 'Отправление' %>
    <%= collection_select :stations, :first_station_id, RailwayStation.all, :id, :title %>
  </div>
  <div class="field">
    <%= label :last_station_id, 'Прибытие' %>
    <%= collection_select :stations, :last_station_id, RailwayStation.all, :id, :title %>
  </div>

  <div class="actions">
    <%= submit_tag 'Поиск' %>
  </div>

  <% if @search %>
    <table>
      <thead>
        <tr>
          <td><%= 'Поезд' %></td>
          <td><%= 'Маршрут' %></td>
          <td><%= 'Время отправления' %></td>
          <td><%= 'Время прибытия' %></td>
        </tr>
      </thead>
      <tbody>
        <% if @trains.empty? %>
          <tr>
            <td>не найдено</td>
          </tr>
        <% else %>
          <% @trains.each do |train| %>
              <tr>
                <td><%= train.number %></td>
                <td><%= train.route.name %></td>
                <td><%= @first_station.time_in(train.route, :departure_time) %></td>
                <td><%= @last_station.time_in(train.route, :arrival_time) %></td>
                <td><%= link_to 'Купить', new_ticket_path(train_id: train.id,
                                                          first_station_id: @first_station.id,
                                                          last_station_id: @last_station.id) %>
                </td>
              </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% end %>